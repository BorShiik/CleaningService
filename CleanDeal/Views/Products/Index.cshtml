@model IEnumerable<CleanDeal.DTOs.ProductDTO>
@{
    ViewData["Title"] = "Produkty";
    bool isAdmin = User.IsInRole("Admin");
    bool isCleaner = User.IsInRole("Cleaner");   
    var pl = System.Globalization.CultureInfo.GetCultureInfo("pl-PL");
}


<section class="section dark-background py-5">
    <div class="container text-center text-white">
        <h1 class="fw-bold mb-0">Nasze produkty</h1>
        <p class="opacity-75">Środki czystości i akcesoria dostępne dla klientów oraz sprzątaczy</p>
        @if (isAdmin)
        {
            <a asp-action="Create" class="btn btn-success mt-3">
                <i class="bi bi-plus-circle me-1"></i>Dodaj produkt
            </a>
        }
    </div>
</section>


<section class="section">
    <div class="container" data-aos="fade-up">

        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Nazwa</th>
                        <th>Cena</th>
                        <th>Dostępne</th>
                        <th class="text-center">
                            @(isAdmin ? "Akcje" : "Koszyk")
                        </th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var p in Model)
                    {
                        <tr>
                            <td>@p.Name</td>
                            <td>@p.Price.ToString("c", pl)</td>
                            <td>
                                @if (p.StockQuantity > 0)
                                {
                                    @p.StockQuantity
                                }
                                else
                                {
                                    <span class="text-danger">товар распродан</span>
                                }
                            </td>


                            <td class="text-center">
                                @if (isAdmin)
                                {
                                    <a asp-action="Edit" asp-route-id="@p.Id"
                                       class="btn btn-sm btn-outline-primary me-1">
                                        <i class="bi bi-pencil-square"></i>
                                    </a>
                                    <a asp-action="Delete" asp-route-id="@p.Id"
                                       class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                }
                                else
                                {
                                    if (p.StockQuantity > 0)
                                    {
                                        <form asp-controller="Cart" asp-action="Add" method="post"
                                              class="d-inline-flex align-items-center">
                                            <input type="hidden" name="id" value="@p.Id" />
                                            <input type="number" name="qty" value="1" min="1"
                                                   class="form-control form-control-sm me-2"
                                                   style="width:80px;" />
                                            <button type="submit" class="btn btn-sm btn-success">
                                                <i class="bi bi-cart-plus me-1"></i>Dodaj
                                            </button>
                                        </form>
                                    }
                                    else
                                    {
                                        <span class="text-danger">Недоступен</span>
                                    }
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

    </div>
</section>
