@using Microsoft.AspNetCore.Identity
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser>   UserManager
@{
    var isAuth = SignInManager.IsSignedIn(User);
    var isAdmin = User.IsInRole("Admin");
    var isCleaner = User.IsInRole("Cleaner");

    var current = UserManager.GetUserAsync(User).GetAwaiter().GetResult();
    string fullName = current?.FullName ?? User.Identity?.Name;
    Layout = null;
}
<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] · CleanDeal</title>

    <!-- Favicons -->
    <link href="~/assets/img/favicon.png" rel="icon" />
    <link href="~/assets/img/apple-touch-icon.png" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700;900&family=Poppins:wght@100;200;300;400;500;600;700;800;900&family=Raleway:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet" />

    <!-- Vendor CSS -->
    <link href="~/assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet" />
    <link href="~/assets/vendor/aos/aos.css" rel="stylesheet" />
    <link href="~/assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" />
    <link href="~/assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet" />

    <!-- Main CSS -->
    <link href="~/assets/css/main.css" rel="stylesheet" />
    <link href="~/css/site.css" rel="stylesheet" asp-append-version="true" />
    @RenderSection("Styles", required: false)
</head>

<body class="index-page">

    <!-- ======= HEADER / NAVBAR ======= -->
    <header id="header" class="header d-flex align-items-center sticky-top">
        <div class="container-fluid container-xl position-relative d-flex align-items-center justify-content-between">
            <a asp-controller="Home" asp-action="Index" class="logo d-flex align-items-center">
                <h1 class="sitename">Clean<span>Deal</span></h1>
            </a>

            <nav id="navmenu" class="navmenu">
                <ul>
                    <li><a asp-controller="Home" asp-action="Index" class="@(ViewContext.RouteData.Values["action"]?.ToString()=="Index" ? "active" : "")">Start</a></li>
                    <li><a asp-controller="Home" asp-action="About">O nas</a></li>
                    <li><a asp-controller="Services" asp-action="Index">Usługi</a></li>
                    <li><a asp-controller="Products" asp-action="Index">Produkty</a></li>

                    @* ------ sekcja uzależniona od ról ------ *@
                    @if (isAuth && !isCleaner)
                    {
                        <li>
                            <a asp-controller="Orders" asp-action="Index">
                                @(isAdmin ? "Zlecenia" : "Moje zlecenia")
                            </a>
                        </li>
                        <li><a asp-controller="Chat" asp-action="Order" asp-route-id="0">Czat</a></li>
                    }
                    @if (isCleaner)
                    {
                        <li class="dropdown">
                            <a href="#"><span>Zlecenia</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
                            <ul>
                                <li><a asp-controller="CleanerOrders" asp-action="Available">Wolne zlecenia</a></li>
                                <li><a asp-controller="CleanerOrders" asp-action="My">Moje zlecenia</a></li>
                            </ul>
                        </li>
                        <li><a asp-controller="Chat" asp-action="Order" asp-route-id="0">Czat</a></li>
                    }
                    @if (!isAdmin)
                    {
                        <li><a asp-controller="Cart" asp-action="Index">Koszyk</a></li>
                    }
                    @if (isAdmin)
                    {
                        <li><a asp-controller="Review" asp-action="All">Opinie</a></li>
                        <li><a asp-controller="Admin" asp-action="Dashboard">Dashboard</a></li>
                    }

                    @* ------ AUTH / PROFIL ------ *@
                    @if (isAuth)
                    {
                        <li class="dropdown">
                            <a href="#">
                                <span>@fullName</span> <i class="bi bi-chevron-down toggle-dropdown"></i>
                            </a>
                            <ul>
                                <li>
                                    <a asp-area="Identity" asp-page="/Account/Manage/Index">Profil</a>
                                </li>
                                <li>
                                    <form asp-area="Identity" asp-page="/Account/Logout" method="post" id="logoutForm">
                                        <button class="dropdown-item btn btn-link ps-3" type="submit">Wyloguj</button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                    }
                    else
                    {
                        <li><a asp-area="Identity" asp-page="/Account/Login">Logowanie</a></li>
                        <li><a asp-area="Identity" asp-page="/Account/Register">Rejestracja</a></li>
                    }
                </ul>

                <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
            </nav>
        </div>
    </header>
    <!-- ======= /HEADER ======= -->
    <!-- ======= MAIN ======= -->
    <main class="main">
        @await Html.PartialAsync("_Alerts")
        @RenderBody()
    </main>

    <!-- ======= FOOTER ======= -->
    <footer id="footer" class="footer light-background">
        <div class="container text-center">
            <p class="mb-0">© @DateTime.UtcNow.Year CleanDeal · Wszelkie prawa zastrzeżone</p>
        </div>
    </footer>

    <!-- ======= SCROLL TOP & PRELOADER ======= -->
    <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
        <i class="bi bi-arrow-up-short"></i>
    </a>
    <div id="preloader"></div>

    <!-- ======= Vendor JS ======= -->
    <script src="~/assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/assets/vendor/php-email-form/validate.js"></script>
    <script src="~/assets/vendor/aos/aos.js"></script>
    <script src="~/assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="~/assets/vendor/purecounter/purecounter_vanilla.js"></script>

    <!-- ======= Main Theme JS & własne ======= -->
    <script src="~/assets/js/main.js"></script>
    @RenderSection("Scripts", required: false)
</body>
</html>
